<div class="page-container">
    <!-- 左カラム: 設定リスト -->
    <div class="list-panel">
        <mat-card class="list-card">
            <mat-card-header class="list-card-header">
                <mat-card-title>接続設定一覧</mat-card-title>
                <button mat-icon-button (click)="onAddNew()" matTooltip="新しい接続設定を追加">
                    <mat-icon>add_circle_outline</mat-icon>
                </button>
            </mat-card-header>
            <mat-card-content>
                <mat-action-list *ngIf="settings.length > 0; else emptyList">
                    <button mat-list-item *ngFor="let setting of settings" (click)="onSelect(setting)"
                        [class.selected-item]="setting.id === selectedSettingId">
                        <mat-icon mat-list-icon>storage</mat-icon>
                        <div mat-line>{{ setting.name }}</div>
                        <div mat-line class="list-item-subtitle">{{ setting.user }}@{{ setting.host }}:{{ setting.port
                            }}</div>
                        <span class="spacer"></span>
                        <button mat-icon-button color="warn" (click)="onDelete(setting.id, $event)"
                            matTooltip="この設定を削除">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </button>
                </mat-action-list>
                <ng-template #emptyList>
                    <div class="empty-list-container">
                        <mat-icon class="empty-list-icon">playlist_add</mat-icon>
                        <p>接続設定がありません。</p>
                        <p>右上の「+」ボタンから新しい設定を追加してください。</p>
                    </div>
                </ng-template>
            </mat-card-content>
        </mat-card>
    </div>

    <!-- 右カラム: 編集フォーム -->
    <div class="form-panel">
        <mat-card *ngIf="isFormVisible" class="form-card">
            <mat-card-header>
                <mat-icon mat-card-avatar fontSet="material-icons-two-tone">edit_note</mat-icon>
                <mat-card-title>{{ isNewMode ? '新規接続設定' : '設定の編集' }}</mat-card-title>
                <mat-card-subtitle>データベースへの接続情報を入力します。</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
                <form [formGroup]="settingsForm" class="settings-form">
                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>設定名</mat-label>
                        <input matInput formControlName="name" required placeholder="例: 開発用DB">
                        <mat-error *ngIf="settingsForm.get('name')?.hasError('required')">必須です</mat-error>
                    </mat-form-field>

                    <div class="form-row">
                        <mat-form-field appearance="outline" class="host-field">
                            <mat-label>ホスト名 / IPアドレス</mat-label>
                            <input matInput formControlName="host" required>
                            <mat-error *ngIf="settingsForm.get('host')?.hasError('required')">必須です</mat-error>
                        </mat-form-field>
                        <mat-form-field appearance="outline" class="port-field">
                            <mat-label>ポート番号</mat-label>
                            <input matInput type="number" formControlName="port" required>
                            <mat-error *ngIf="settingsForm.get('port')?.hasError('required')">必須です</mat-error>
                        </mat-form-field>
                    </div>

                    <div class="form-row">
                        <mat-form-field appearance="outline" class="user-field">
                            <mat-label>ユーザー名</mat-label>
                            <input matInput formControlName="user" required>
                            <mat-error *ngIf="settingsForm.get('user')?.hasError('required')">必須です</mat-error>
                        </mat-form-field>
                        <mat-form-field appearance="outline" class="password-field">
                            <mat-label>パスワード</mat-label>
                            <input matInput type="password" formControlName="password">
                        </mat-form-field>
                    </div>

                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>データベース名</mat-label>
                        <input matInput formControlName="database" required>
                        <mat-error *ngIf="settingsForm.get('database')?.hasError('required')">必須です</mat-error>
                    </mat-form-field>
                </form>
            </mat-card-content>
            <mat-card-actions align="end">
                <button mat-stroked-button (click)="onTestConnection()"
                    [disabled]="settingsForm.invalid || isProcessing">
                    <mat-icon>power</mat-icon>
                    接続テスト
                </button>
                <button mat-raised-button color="primary" (click)="onSave()"
                    [disabled]="settingsForm.invalid || isProcessing">
                    <mat-icon>save</mat-icon>
                    保存
                </button>
            </mat-card-actions>
        </mat-card>

        <div *ngIf="!isFormVisible" class="placeholder-container">
            <mat-icon class="placeholder-icon">arrow_back</mat-icon>
            <p class="placeholder-text">左のリストから設定を選択するか、<br>新しい設定を追加してください。</p>
        </div>
    </div>
</div>