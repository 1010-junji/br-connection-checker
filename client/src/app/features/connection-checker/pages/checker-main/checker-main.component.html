<div class="checker-container">
    <!-- モード選択カード -->
    <mat-card class="mode-selection-card">
        <mat-card-content>
            <mat-form-field appearance="outline" class="mode-selector">
                <mat-label>チェックするコンポーネントを選択してください</mat-label>
                <mat-select [value]="selectedMode" (selectionChange)="onModeChange($event.value)"
                    [disabled]="isRunning">
                    <mat-option *ngFor="let mode of modes" [value]="mode.id">
                        {{ mode.name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </mat-card-content>
    </mat-card>

    <ng-container *ngIf="config">
        <!-- 条件入力フォーム -->
        <mat-card class="form-card">
            <mat-card-content>
                <div class="grid-container">
                    <!-- 左半分: 入力フォーム -->
                    <div class="form-container">
                        <!-- チェック対象グループごとにループ -->
                        <div *ngFor="let target of config.checkTargets" class="check-target-group">
                            <h4 class="target-title">{{ target.title }}</h4>
                            <!-- 行ごとにループ -->
                            <div *ngFor="let row of target.fieldRows" class="form-row">
                                <!-- フィールドごとにループ -->
                                <mat-form-field *ngFor="let field of row.fields" [ngClass]="field.class"
                                    appearance="outline" class="dense-form-field">
                                    <mat-label>{{ field.label }}</mat-label>
                                    <input matInput [(ngModel)]="field.value" [type]="field.type"
                                        [disabled]="isRunning">
                                </mat-form-field>
                            </div>
                        </div>
                    </div>

                    <!-- 右半分: SVG画像 -->
                    <div class="image-container">
                        <div [ngSwitch]="selectedMode" class="svg-wrapper">
                            <app-das-svg *ngSwitchCase="'das'" [params]="getFormParams()"></app-das-svg>
                            <app-ds-svg *ngSwitchCase="'ds'" [params]="getFormParams()"></app-ds-svg>
                            <app-kapplets-svg *ngSwitchCase="'kapplets'" [params]="getFormParams()"></app-kapplets-svg>
                            <app-mc-svg *ngSwitchCase="'mc'" [params]="getFormParams()"></app-mc-svg>
                            <app-rs-svg *ngSwitchCase="'rs'" [params]="getFormParams()"></app-rs-svg>
                        </div>
                    </div>
                </div>
            </mat-card-content>
            <mat-card-actions align="end">
                <button mat-raised-button color="primary" (click)="runCheck()" [disabled]="isRunning || !config">
                    <mat-icon>play_arrow</mat-icon>
                    チェック実行
                </button>
            </mat-card-actions>
        </mat-card>

        <!-- 実行中のプログレスバー -->
        <mat-progress-bar mode="indeterminate" *ngIf="isRunning"></mat-progress-bar>

        <!-- 実行結果表示エリア -->
        <mat-card class="log-card">
            <mat-card-header>
                <mat-card-title>実行結果</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <pre #logContainer class="log-output" [innerHTML]="logOutput"></pre>
            </mat-card-content>
            <mat-card-actions align="end">
                <button mat-stroked-button color="primary" (click)="saveLog()" [disabled]="isRunning || !logOutput">
                    <mat-icon>save_alt</mat-icon>
                    結果をファイルに出力
                </button>
            </mat-card-actions>
        </mat-card>
    </ng-container>

    <!-- モードが選択されていない場合に表示するメッセージ -->
    <div *ngIf="!config && !isRunning" class="placeholder-container">
        <mat-icon class="placeholder-icon">rule</mat-icon>
        <p class="placeholder-text">上記ドロップダウンからチェックしたいコンポーネントを選択してください。</p>
    </div>
</div>